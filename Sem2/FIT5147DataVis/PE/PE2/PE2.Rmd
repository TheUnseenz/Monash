Section 0: Load data
```{r eval=FALSE}
# install.packages('shiny')
# install.packages('ggplot2')
# install.packages('leaflet')

# install.packages("this.path")
# install.packages('dplyr')
```
```{r eval=FALSE}
# https://stackoverflow.com/a/74626705
library(this.path)
setwd(this.path::here())
getwd()
```
```{r eval=FALSE}
library(shiny)
library(ggplot2)
library(leaflet)
# import the dataset
ausstage <- read.csv('AusStage_S12025PE2v2.csv')
head(ausstage)


```


Section 1: Vis 1
Visualisation should be static (not interactive)
1.  VIS 1 should show the top 10 most commonly used venues of events 
    according to the number of Event_Identifier values for each Venue_Name 
    value. The visualisation must show the magnitude of the usage for each 
    venue. Order your VIS 1 from most events to least events.   
2.  The visualisation must show the breakdown of the Primary_Genre values for 
    each venue, using a suitable visual variable of your choice.  
3.  VIS 1 must be created using ggplot2.
```{r eval=FALSE}
library(dplyr)
# Step 1: Count the total occurrences of each Name
name_totals <- ausstage %>%
  group_by(Venue.Name) %>%
  summarise(TotalCount = n()) %>%
  arrange(desc(TotalCount))

# Step 2: Get the top 10 names
top_10_names <- head(name_totals, 10)$Venue.Name

# Step 3: Filter the original data to include only the top 10 names
top_10_data <- ausstage %>%
  filter(Venue.Name %in% top_10_names)

# Step 4: Count the occurrences of each Category within the top 10 names
data <- top_10_data %>%
  group_by(Venue.Name, Primary.Genre, Suburb, Latitude, Longitude, First.Year, Last.Year) %>%
  summarise(Count = n()) %>%
  ungroup()

# Step 5: Order the 'Name' factor based on their total count (within the top 10) for plotting
data_ordered <- data %>%
  left_join(name_totals %>% filter(Venue.Name %in% top_10_names), by = "Venue.Name") %>%
  mutate(Venue.Name = factor(Venue.Name, levels = head(name_totals$Venue.Name, 10)))

# Step 6: Create the stacked bar chart for the top 10 names
data_vis <- ggplot(data_ordered, aes(x = Venue.Name, y = Count, fill = Primary.Genre)) +
  geom_bar(stat = "identity") +
  labs(title = "Top 10 Names by Frequency (Stacked by Category)",
       x = "Name",
       y = "Count",
       fill = "Category") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```
Section 2: Interactive map
An interactive proportional symbol map using Leaflet.
1.  Plot the venues on your map using circle markers or equivalent, with the 
    following data mappings and design aspects:  
    a.  Each symbol on the map is for a separate Primary_Genre. 
    b.  Colour should be mapped to Primary_Genre. You can choose an 
    appropriate colour palette for the type of data.  
    c.  Radius should be mapped to the number of events for that genre at 
    that venue (you may need to scale the size so as to reduce the data 
    overlap on the map, or use opacity, but some overlap is expected) 
    d.  Provide a colour legend for your map.  
2.  Implement the following interactive features:  
    a.  Provide a tooltip for each circle marker on mouse hover-over that 
    shows the name of the venue, the suburb, the genre, and the number 
    of events for that genre.  
    b.  Add a numerical slider (a slider to set a maximum and minimum value) 
    for filtering how many years back the events occurred. By default, all 
    venues should be shown on the map, i.e., the slidersâ€™ settings should be 
    equal to the maximum and minimum available values. The slider should 
    state which years will be plotted on the map. 
    
```{r eval=FALSE}
# install.packages('leaflet.extras2')
# install.packages('sf')
```
```{r eval=FALSE}

# Step 5: Define a color palette for the categories (assuming 5 categories)
category_colors <- colorFactor(palette = "plasma", domain = data$Primary.Genre)

# Step 6: Scale the radius based on the count (adjust the multiplier as needed)
scale_factor <- 5 # Adjust this to control the size of the circles

# Function to add circles with common properties
add_circles <- function(map, data) {
  map %>%
    addCircleMarkers(
      data = data,
      color = ~category_colors(data$Primary.Genre),
      radius = ~sqrt(data$Count)*scale_factor,
      fillOpacity = 0.2,
      label = ~lapply(paste(
        "<b>Venue Name:</b>", Venue.Name, "<br>",
        "<b>Suburb:</b>", Suburb, "<br>",
        "<b>Primary Genre:</b>", Primary.Genre, "<br>",
        "<b>Number of Events:</b>", Count
      ), HTML)
  )
}

data_map <- leaflet() %>%
  addProviderTiles(providers$CartoDB.Positron) %>%
  setView(lng = 144.962, lat = -37.8162, zoom = 12) %>%
  addTiles() %>%
  addLegend(pal = category_colors, values = data$Primary.Genre, title = "Primary.Genre") %>%
  add_circles(map=., data=data)
  # addCircleMarkers(
  #   data = data,
  #   color = ~category_colors(data$Primary.Genre),
  #   radius = ~sqrt(data$Count*scale_factor),
  #   fillOpacity = 0.2,
  #   label = ~lapply(paste(
  #     "<b>Venue Name:</b>", Venue.Name, "<br>",
  #     "<b>Suburb:</b>", Suburb, "<br>",
  #     "<b>Primary Genre:</b>", Primary.Genre, "<br>",
  #     "<b>Number of Events:</b>", Count
  #   ), HTML)
  # )
```
```{r eval=FALSE}
data_vis
data_map
```
Section 3: Data Visualisation Narrative 
use a fixedPage (not a fluidPage) layout and are expected to position the 
visualisation elements in an appropriate number of rows and columns. 
1)  Provide a descriptive title for your visualisation. 
2)  The descriptive text in the description boxes should both describe and 
    interpret the related visualisations. They should help the viewer see some 
    data insights you have identified, especially when using the interactive 
    features.  
3)  Information on the original (not the file we are using, but the one it is adapted 
    from) data source should be provided for all data visualisations2. In the 
    relevant layout location (see Figure 1) briefly provide information about the 
    original data source, including the: 
    a)  name of the data; 
    b)  URL to the data; 
    c)  name of the licensor;  
    d)  date of the version of the original data used for the visualisation. 

```{r eval=FALSE}
data_vis
data_map
library(shiny) # For sliderInput

# --- 5. Create the HTML Structure for the Fixed Page Layout ---
page_title <- "Venue and Category Analysis"
map_description <- "This interactive map displays the top 10 most frequent venues, with circle markers representing the number of events for each category at that venue. Hover over a marker for details. Use the slider below to filter venues by the year they occurred in."
bar_chart_description <- "This stacked bar chart shows the breakdown of event counts by category for each of the top 10 most frequent venues."
data_source_info <- "Data source: [Insert your data source information here]"

# --- 6. Create the Shiny UI for the Fixed Page Layout with Slider ---
ui <- fixedPage(
  title = page_title,
  h1(page_title),
  # div(leafletOutput("map"), style = "width:100%;height:400px"),
  fixedRow(column(12, leafletOutput("map", height = "600px"))),
  p(map_description),
  fluidRow(
    div(renderPlot({data_vis}), style = "width:60%;float:left;"),
    div(p(bar_chart_description), style = "width:40%;float:right;")
  ),
  hr(),
  p(data_source_info),
  hr(),
  sliderInput(
    inputId = "year_range",
    label = "Filter Map by Year:",
    min = min(data$First.Year, data$Last.Year, na.rm = TRUE),
    max = max(data$First.Year, data$Last.Year, na.rm = TRUE),
    value = c(min(data$First.Year, data$Last.Year, na.rm = TRUE), max(data$First.Year, data$Last.Year, na.rm = TRUE)),
    step = 1,
    sep = "",
    animate = FALSE
  )
)


# --- 7. Create the Shiny Server Logic for Interactive Filtering ---
server <- function(input, output, session) {
  output$map <- renderLeaflet({
    data_map
  })

  observe({
    min_year <- input$year_range[1]
    max_year <- input$year_range[2]

    filtered_map_data <- data %>%
      filter(data$First.Year >= min_year & data$Last.Year <= max_year) %>%
      group_by(data$Venue.Name, data$Primary.Genre, data$Latitude, data$Longitude) %>%
      summarise(Count = n()) %>%
      ungroup()

    leafletProxy("map", data = filtered_map_data) %>%
      clearMarkers() %>%
      add_circles(map=., data=filtered_map_data)
  })
}

# --- 8. Run the Shiny App ---
shinyApp(ui = ui, server = server)

```
```{r eval=FALSE}
library(dplyr)
library(ggplot2)
library(leaflet)
library(htmltools)
library(htmlwidgets)
library(shiny) # For sliderInput

# Assuming your data frame is named 'data' and has columns:
# 'Name', 'Category', 'Latitude', 'Longitude', 'First.Year', 'Last.Year'

# --- 1. Data Preparation (Same as before) ---
name_totals <- data %>% group_by(Name) %>% summarise(TotalCount = n()) %>% arrange(desc(TotalCount))
top_10_names <- head(name_totals, 10)$Name
top_10_data <- data %>% filter(Name %in% top_10_names)
data <- top_10_data %>% group_by(Name, Category, Latitude, Longitude) %>% summarise(Count = n()) %>% ungroup()
category_colors_factor <- factor(unique(data$Category))
category_colors <- colorFactor(palette = "Set2", domain = category_colors_factor)
scale_factor <- 5

# --- 2. Create the Interactive Map with Leaflet (Slightly Modified for Single Page) ---
m <- leaflet(data) %>%
  addTiles() %>%
  addLegend(pal = category_colors, values = ~Category, title = "Category") %>%
  addCircleMarkers(
    lng = ~Longitude,
    lat = ~Latitude,
    radius = ~sqrt(Count) * scale_factor,
    color = ~category_colors(Category),
    fillOpacity = 0.7,
    stroke = FALSE,
    popup = ~paste(
      "<b>Name:</b>", htmlEscape(Name), "<br>",
      "<b>Category:</b>", htmlEscape(Category), "<br>",
      "<b>Count:</b>", Count
    ),
    group = "all_years"
  )

# --- 3. Implement Year Filtering for Map (as a separate function) ---
create_year_filtered_map <- function(data_subset) {
  leaflet(data_subset) %>%
    addTiles() %>%
    addLegend(pal = category_colors, values = ~Category, title = "Category") %>%
    addCircleMarkers(
      lng = ~Longitude,
      lat = ~Latitude,
      radius = ~sqrt(Count) * scale_factor,
      color = ~category_colors(Category),
      fillOpacity = 0.7,
      stroke = FALSE,
      popup = ~paste(
        "<b>Name:</b>", htmlEscape(Name), "<br>",
        "<b>Category:</b>", htmlEscape(Category), "<br>",
        "<b>Count:</b>", Count
      )
    )
}

# --- 4. Create the Stacked Bar Chart ---
data_ordered <- data %>%
  left_join(name_totals %>% filter(Name %in% top_10_names), by = "Name") %>%
  mutate(Name = factor(Name, levels = head(name_totals$Name, 10)))

stacked_bar_chart <- ggplot(data_ordered, aes(x = Name, y = Count, fill = Category)) +
  geom_bar(stat = "identity") +
  labs(title = "Category Breakdown of Top 10 Names",
       x = "Name",
       y = "Count",
       fill = "Category") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# --- 5. Create the HTML Structure for the Fixed Page Layout ---
page_title <- "Venue and Category Analysis"
map_description <- "This interactive map displays the top 10 most frequent venues, with circle markers representing the number of events for each category at that venue. Hover over a marker for details. Use the slider below to filter venues by the year they occurred in."
bar_chart_description <- "This stacked bar chart shows the breakdown of event counts by category for each of the top 10 most frequent venues."
data_source_info <- "Data source: [Insert your data source information here]"

# --- 6. Create the Shiny UI for the Fixed Page Layout with Slider ---
ui <- fixedPage(
  title = page_title,
  h1(page_title),
  div(leafletOutput("map"), style = "width:100%;height:400px"),
  p(map_description),
  fluidRow(
    div(renderPlot(stacked_bar_chart), style = "width:60%;float:left;"),
    div(p(bar_chart_description), style = "width:40%;float:right;")
  ),
  hr(),
  p(data_source_info),
  hr(),
  sliderInput(
    inputId = "year_range",
    label = "Filter Map by Year:",
    min = min(data$First.Year, data$Last.Year, na.rm = TRUE),
    max = max(data$First.Year, data$Last.Year, na.rm = TRUE),
    value = c(min(data$First.Year, data$Last.Year, na.rm = TRUE), max(data$First.Year, data$Last.Year, na.rm = TRUE)),
    step = 1,
    sep = "",
    animate = FALSE
  )
)

# --- 7. Create the Shiny Server Logic for Interactive Filtering ---
server <- function(input, output, session) {
  output$map <- renderLeaflet({
    leaflet(data) %>%
      addTiles() %>%
      addLegend(pal = category_colors, values = ~Category, title = "Category") %>%
      addCircleMarkers(
        lng = ~Longitude,
        lat = ~Latitude,
        radius = ~sqrt(Count) * scale_factor,
        color = ~category_colors(Category),
        fillOpacity = 0.7,
        stroke = FALSE,
        popup = ~paste(
          "<b>Name:</b>", htmlEscape(Name), "<br>",
          "<b>Category:</b>", htmlEscape(Category), "<br>",
          "<b>Count:</b>", Count
        )
      )
  })

  observe({
    min_year <- input$year_range[1]
    max_year <- input$year_range[2]

    filtered_map_data <- top_10_data %>%
      filter(First.Year >= min_year & Last.Year <= max_year) %>%
      group_by(Name, Category, Latitude, Longitude) %>%
      summarise(Count = n()) %>%
      ungroup()

    leafletProxy("map", data = filtered_map_data) %>%
      clearMarkers() %>%
      addCircleMarkers(
        lng = ~Longitude,
        lat = ~Latitude,
        radius = ~sqrt(Count) * scale_factor,
        color = ~category_colors(Category),
        fillOpacity = 0.7,
        stroke = FALSE,
        popup = ~paste(
          "<b>Name:</b>", htmlEscape(Name), "<br>",
          "<b>Category:</b>", htmlEscape(Category), "<br>",
          "<b>Count:</b>", Count
        )
      )
  })
}

# --- 8. Run the Shiny App ---
shinyApp(ui = ui, server = server)

```


```
# Define UI
ui <- fixedPage(
  # Title
  titlePanel("My Interactive Data Visualization App"),
  
  # First fixedRow for the map with its description
  fixedRow(
    column(12, 
           leafletOutput("map", height = "600px")  # Set height for the map
    ),
    column(12, 
           p("This is the interactive map that displays data points of interest. You can zoom in and out to explore the map.")  # Description for map
    )
  ),
  
  # Second fixedRow for the bar chart and its description (side by side)
  fixedRow(
    column(6, 
           plotOutput("chart", height = "400px")  # Set height for the chart
    ),
    column(6, 
           p("This bar chart represents the miles per gallon (mpg) of cars in the dataset, categorized by the number of cylinders (cyl).")  # Description for the chart
    )
  ),
  
  # Third fixedRow for the final description text
  fixedRow(
    column(12, 
           p("This page demonstrates how to combine different types of data visualizations: an interactive map and a static bar chart, with accompanying descriptions.")  # Final description
    )
  )
)

# Define server logic
server <- function(input, output, session) {

  # Render the interactive Leaflet map
  output$map <- renderLeaflet({
    data_map
  })

  # Render the static bar chart
  output$chart <- renderPlot({
    data_chart
  })

}
```